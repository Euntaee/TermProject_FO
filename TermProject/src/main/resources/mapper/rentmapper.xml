<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
         PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.demo.dao.RentDAO">

	<resultMap type="com.project.demo.vo.BookVO" id="BookVO">
		<result column="book_no" property="bookNo"/>
		<result column="book_img" property="bookImg"/>
		<result column="book_author" property="bookAuthor"/>
		<result column="book_title" property="bookTitle"/>
		<result column="book_publish" property="bookPublish"/>
		<result column="book_content" property="bookContent"/>
		<result column="book_genre" property="bookGenre"/>
		<result column="book_hit" property="bookHit"/>
		<result column="book_regdate" property="bookRegdate"/>
	</resultMap>
	
	<resultMap type="com.project.demo.vo.RentVO" id="RentVO">
	    <result column="rent_no" property="rentNo"/>
	    <result column="rent_check" property="rentVheck"/>		
		<result column="rent_startdate" property="rentStartdate"/>
		<result column="rent_enddate" property="rentEnddate"/>
		<result column="user_id" property="userId"/>		
		<result column="book_no" property="bookNo"/>
		
		<result column="book_img" property="bookImg"/>
		<result column="book_author" property="bookAuthor"/>
		<result column="book_title" property="bookTitle"/>
		<result column="book_publish" property="bookPublish"/>
		<result column="book_content" property="bookContent"/>
		<result column="book_genre" property="bookGenre"/>
		<result column="book_hit" property="bookHit"/>
		<result column="book_regdate" property="bookRegdate"/>		
		  
		<collection property="BookVO" javaType="java.util.ArrayList" resultMap="BookVO" />		
	</resultMap>	

	<insert id="rentInsert" useGeneratedKeys="true" keyProperty="rent_no">
	<![CDATA[
		INSERT INTO
		rent (rent_no, rent_startdate, rent_enddate, book_no, user_id, rent_check)	
		VALUES
		(0,DATE(NOW()) ,date_add(date_format(now(),'%y-%m-%d'),INTERVAL 7 DAY)
		,#{book_no},#{user_id},0)
		]]>
	</insert>
	
	<select id="rentSelect" resultMap="RentVO" parameterType="com.project.demo.vo.RentVO">
	<![CDATA[
		SELECT /*RentDAO.rentSelect(예약내역 조회)*/
		       b.book_title
		     , b.book_author 
		     , a.rent_startdate 
		     , a.rent_enddate
	      FROM rent a
	      LEFT OUTER JOIN book b
	        ON b.book_no = a.book_no
	     WHERE a.user_id=#{user_id}
		]]> 
	</select>
	
	<update id="bookIncreaseHit">
	<![CDATA[
	    UPDATE book
	    SET book_hit=book_hit+1
	    WHERE book_no = #{book_no}	
	]]>      
	</update>	
</mapper>

